#!/usr/bin/ruby
# -*- coding: utf-8 -*-
# BUGs: not working with redirected output ?!:
# > cat 1.fifo | ruby -ne 'puts "<<#{gets}"' | cat #=> produces nothing
# NY fix from: //www.unix.com/unix-dummies-questions-answers/23590-getting-time-mili-seconds.html
# > cat 1.fifo | while read line; do echo $(date +'%F %l:%M:%S').$(( $(date +%N) / 100000 ))│ $line; done | cat
# < bash: 029351000: value too great for base (error token is "029351000")
# FIX: > cat 1.fifo | while read line; do echo `ruby -e 't=Time.now; puts "#{t .strftime %q{%Y-%m-%d %H:%M:%S}}.#{t.usec.to_s[0..4]}

puts "argv:#{ARGV}, -size:#{ARGV.size}" if $DEBUG
def t; t = Time.now; "#{t .strftime %q{%Y-%m-%d %H:%M:%S}}.#{t.usec.to_s[0..4]}" end
IO.popen "inotail -f #{ARGV[0]}" do |f| while line = f.gets; puts "#{t}│#{line}" end end if ARGV.size>0

# USE:> cat 1.fifo | ruby ~/bin/inotail-t.rb # BUG: not working with redirected output :-(
$stderr .puts "#{$0}: <&1"
while line = gets; puts "#{t}│#{line}" end
